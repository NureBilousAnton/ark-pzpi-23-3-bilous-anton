                    –ú–Ü–ù–Ü–°–¢–ï–†–°–¢–í–û –û–°–í–Ü–¢–ò –Ü –ù–ê–£–ö–ò –£–ö–†–ê–á–ù–ò
   –•–ê–†–ö–Ü–í–°–¨–ö–ò–ô –ù–ê–¶–Ü–û–ù–ê–õ–¨–ù–ò–ô –£–ù–Ü–í–ï–†–°–ò–¢–ï–¢ –†–ê–î–Ü–û–ï–õ–ï–ö–¢–†–û–ù–Ü–ö–ò



                           –ö–∞—Ñ–µ–¥—Ä–∞ –ü—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—ó




                                        –ó–≤—ñ—Ç
                             –∑ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ ‚Ññ2
                     –∑ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏: ¬´–ê–Ω–∞–ª—ñ–∑ —Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥—É¬ª
–∑ —Ç–µ–º–∏: ¬´–†–æ–∑—Ä–æ–±–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ
                           –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É (API)¬ª




–í–∏–∫–æ–Ω–∞–≤:                                                               –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤:
—Å—Ç. –≥—Ä. –ü–ó–ü–Ü-23-3                                                 —Å—Ç. –≤–∏–∫–ª. –∫–∞—Ñ. –ü–Ü
–ë—ñ–ª–æ—É—Å –ê. –ê.                                                        –°–æ–∫–æ—Ä—á—É–∫ –Ü. –ü.




                                   –•–∞—Ä–∫—ñ–≤ ‚Äì 2025
                                                                                2
 2 –†–û–ó–†–û–ë–ö–ê –ë–ê–ó–ò –î–ê–ù–ò–• –î–õ–Ø –°–ï–†–í–ï–†–ù–û–á –ß–ê–°–¢–ò–ù–ò –°–ò–°–¢–ï–ú–ò –¢–ê
            –ü–†–ò–ö–õ–ê–î–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ù–û–ì–û –Ü–ù–¢–ï–†–§–ï–ô–°–£ (API)
     2.1 –ó–∞–≤–¥–∞–Ω–Ω—è

     –û–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –ø—Ä–æ—Ü–µ—Å–æ–º —Ä–æ–∑—Ä–æ–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏,
–≤–∫–ª—é—á–∞—é—á–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (–ë–î), —Ä–æ–∑—Ä–æ–±–∫—É API –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –∫–ª—ñ—î–Ω—Ç–∞–º–∏,
—Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É (—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è) —ó—Ö–Ω—å–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó. –û–≤–æ–ª–æ–¥—ñ—Ç–∏ –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è
–¥—ñ–∞–≥—Ä–∞–º UML —Ç–∞ ER, —Ä–æ–∑—Ä–æ–±–∫–∏ –ë–î, –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó API, –∞ —Ç–∞–∫–æ–∂ —Ä–æ–±–æ—Ç–∏ –∑
—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—è–º–∏ Git —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Ö–Ω—ñ—á–Ω–æ—ó –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó.

     2.2 –ë—É–¥–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏
     2.2.1 –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏

     –°–µ—Ä–≤–µ—Ä–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ —Å–∏—Å—Ç–µ–º–∏ ¬´LumiRum¬ª —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –º–æ–≤–∏
–ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è Rust, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∏—Å–æ–∫—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —Ç–∞ –±–µ–∑–ø–µ–∫—É
–ø–∞–º‚Äô—è—Ç—ñ. –í —è–∫–æ—Å—Ç—ñ –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É –æ–±—Ä–∞–Ω–æ Axum, —è–∫–∏–π –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º—É
—Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è Tokio.
     –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º Vertical Slice Architecture
(–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö –∑—Ä—ñ–∑—ñ–≤). –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–æ—ó —à–∞—Ä–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
(Controller-Service-Repository), –∫–æ–¥ –æ—Ä–≥–∞–Ω—ñ–∑–æ–≤–∞–Ω–æ –Ω–∞–≤–∫–æ–ª–æ –±—ñ–∑–Ω–µ—Å-—Ñ—ñ—á (features).
–ö–æ–∂–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è –≤ –º–æ–¥—É–ª—ñ ¬´features¬ª –º—ñ—Å—Ç–∏—Ç—å –ø–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –ª–æ–≥—ñ–∫–∏, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó –¥–ª—è
—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ (–º–∞—Ä—à—Ä—É—Ç–∏ API, —Ä–æ–±–æ—Ç–∞ –∑ –ë–î, –º–æ–¥–µ–ª—ñ, –±—ñ–∑–Ω–µ—Å-
–ø—Ä–∞–≤–∏–ª–∞).
     –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É (¬´server/src/features¬ª):
     –∞)     ¬´auth¬ª ‚Äì –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é, –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
            –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (JWT, —Ö–µ—à—É–≤–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤ —á–µ—Ä–µ–∑ Argon2);
     –±)     ¬´devices¬ª ‚Äì –ª–æ–≥—ñ–∫–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è IoT-–ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏, —ó—Ö –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞
            –ø—Ä–∏–≤‚Äô—è–∑–∫–∞ –¥–æ –≤–ª–∞—Å–Ω–∏–∫—ñ–≤;
     –≤)     ¬´profiles¬ª ‚Äì —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ —Ü–∏—Ä–∫–∞–¥–Ω–∏—Ö —Ä–∏—Ç–º—ñ–≤ —Ç–∞ —Ä–æ–∑–∫–ª–∞–¥—ñ–≤
            –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è;
      –≥)    ¬´telemetry¬ª ‚Äì –∑–±—ñ—Ä —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ –¥–∞—Ç—á–∏–∫—ñ–≤ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤;
     –¥)     ¬´system¬ª ‚Äì —Å–∏—Å—Ç–µ–º–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏ (health-check) —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è.
                                                                                 3
     –¢–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∏—Å–æ–∫—É –∑–≤‚Äô—è–∑–Ω—ñ—Å—Ç—å –∫–æ–¥—É –≤ –º–µ–∂–∞—Ö –æ–¥–Ω—ñ—î—ó —Ñ—ñ—á—ñ —Ç–∞ –Ω–∏–∑—å–∫—É
–∑–≤‚Äô—è–∑–Ω—ñ—Å—Ç—å (coupling) –º—ñ–∂ —Ä—ñ–∑–Ω–∏–º–∏ —Ñ—ñ—á–∞–º–∏, —â–æ —Å–ø—Ä–æ—â—É—î –ø—ñ–¥—Ç—Ä–∏–º–∫—É —Ç–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
—Å–∏—Å—Ç–µ–º–∏.

     2.2.2 –†–æ–ª—å–æ–≤–∞ –º–æ–¥–µ–ª—å —Å–∏—Å—Ç–µ–º–∏

     –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª—ñ–∑—É—î –≥–Ω—É—á–∫—É –º–æ–¥–µ–ª—å —Ä–æ–∑–º–µ–∂—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É (RBAC), —è–∫–∞
–≤–∫–ª—é—á–∞—î –ø‚Äô—è—Ç—å –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä–æ–ª–µ–π:
     –∞)    –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä (Admin): –º–∞—î –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ —Å–∏—Å—Ç–µ–º–∏,
           —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —Å—Ç–∞–Ω—É —Å–µ—Ä–≤–µ—Ä–∞;
     –±)    –í–ª–∞—Å–Ω–∏–∫ (Owner): –æ—Å–Ω–æ–≤–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —â–æ —Ä–µ—î—Å—Ç—Ä—É—î—Ç—å—Å—è –≤ —Å–∏—Å—Ç–µ–º—ñ.
           –ú–∞—î –ø—Ä–∞–≤–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–º–∏ –ø—Ä–æ—Ñ—ñ–ª—è–º–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
           —Ç–∞ IoT-–ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏. –¢–∞–∫–æ–∂ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—ñ–¥–ª–µ–≥–ª—ñ –∞–∫–∞—É–Ω—Ç–∏ (—Ä–æ–ª—å
           ¬´–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á¬ª);
     –≤)    –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á (User): –ø—ñ–¥–ª–µ–≥–ª–∏–π –∞–∫–∞—É–Ω—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –í–ª–∞—Å–Ω–∏–∫–æ–º. –ú–æ–∂–µ
           –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–≤–æ—ó–º–∏ –ø—Ä–æ—Ñ—ñ–ª—è–º–∏ —Ç–∞ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏, —Ç–∞ –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
           –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ –í–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É –π–æ–≥–æ –ø—É–±–ª—ñ—á–Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—ñ–≤, –∞–ª–µ –º–∞—î
           –æ–±–º–µ–∂–µ–Ω—ñ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–º—ñ–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π;
     –≥)    –ü—Ä–∏—Å—Ç—Ä—ñ–π    (Device):     —Ä–æ–ª—å   –¥–ª—è    –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–∏—Ö    IoT-–∫–ª—ñ—î–Ω—Ç—ñ–≤.
           –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —É–Ω—ñ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ
           –∫–ª—é—á–∞. –î–æ–∑–≤–æ–ª—è—î –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—é —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó;
     –¥)    –ì—ñ—Å—Ç—å (Guest): —Ñ—ñ–∑–∏—á–Ω–∞ –æ—Å–æ–±–∞, —è–∫–∞ –Ω–µ –º–∞—î —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–∏—Å—Ç–µ–º–∏,
           –∞–ª–µ –≤–∑–∞—î–º–æ–¥—ñ—î –∑ –Ω–µ—é —á–µ—Ä–µ–∑ —Ñ—ñ–∑–∏—á–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è
           –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç—ñ–Ω—ñ), —â–æ —Ç–∏–º—á–∞—Å–æ–≤–æ –∫–µ—Ä—É—î –∞–≤—Ç–æ–º–∞—Ç–∏–∫–æ—é.

     2.2.3 –ú–æ–¥–µ–ª—ñ –¥–∞–Ω–∏—Ö —Ç–∞ –∑–≤‚Äô—è–∑–∫–∏

     –ù–∞ –æ—Å–Ω–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ —Ç–∞ –≤–∏–∑–Ω–∞—á–µ–Ω–∏—Ö —Ä–æ–ª–µ–π, –±—É–ª–æ —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ
–Ω–∞—Å—Ç—É–ø–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
     –∞)    ¬´users¬ª (–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ): –∑–±–µ—Ä—ñ–≥–∞—î –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, —Ä–æ–ª—ñ —Ç–∞ —Ö–µ—à—ñ –ø–∞—Ä–æ–ª—ñ–≤.
           –ú—ñ—Å—Ç–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —ñ—î—Ä–∞—Ä—Ö—ñ—ó
           –í–ª–∞—Å–Ω–∏–∫-–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á);
                                                                                  4
     –±)    ¬´devices¬ª (–ü—Ä–∏—Å—Ç—Ä–æ—ó): –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ñ—ñ–∑–∏—á–Ω—ñ IoT-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏. –ö–æ–∂–µ–Ω
           –ø—Ä–∏—Å—Ç—Ä—ñ–π    –Ω–∞–ª–µ–∂–∏—Ç—å   –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É    –í–ª–∞—Å–Ω–∏–∫—É    —Ç–∞   –º–∞—î   —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π
           —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —ñ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á;
     –≤)    ¬´profiles¬ª (–ü—Ä–æ—Ñ—ñ–ª—ñ): –º—ñ—Å—Ç–∏—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
           (—Ü–∏—Ä–∫–∞–¥–Ω—ñ –∫—Ä–∏–≤—ñ, —Ç–∞–π–º—ñ–Ω–≥–∏). –ü—Ä–æ—Ñ—ñ–ª—ñ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω—ñ –¥–æ –í–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –¥–æ –¥–µ–≤–∞–π—Å—É;
      –≥)   ¬´telemetry¬ª (–¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è): —á–∞—Å–æ–≤–∏–π —Ä—è–¥ –¥–∞–Ω–∏—Ö (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –æ—Å–≤—ñ—Ç–ª–µ–Ω—ñ—Å—Ç—å,
           —Ä—É—Ö), —â–æ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏.
     –û–ø–∏—Å –∑–≤‚Äô—è–∑–∫—ñ–≤ –º—ñ–∂ –º–æ–¥–µ–ª—è–º–∏:
      –∞)   –í–ª–∞—Å–Ω–∏–∫ ‚Äì –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª (One-to-Many). –û–¥–∏–Ω
           –í–ª–∞—Å–Ω–∏–∫ –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–≥–∞—Ç–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤;
     –±)    –í–ª–∞—Å–Ω–∏–∫ ‚Äì –ü—Ä–∏—Å—Ç—Ä–æ—ó: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª. –ü—Ä–∏—Å—Ç—Ä–æ—ó –Ω–∞–ª–µ–∂–∞—Ç—å
           –í–ª–∞—Å–Ω–∏–∫—É;
     –≤)    –í–ª–∞—Å–Ω–∏–∫ ‚Äì –ü—Ä–æ—Ñ—ñ–ª—ñ: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª. –ö–æ–∂–µ–Ω –ø—Ä–æ—Ñ—ñ–ª—å
           —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º –í–ª–∞—Å–Ω–∏–∫–æ–º;
      –≥)   –ü—Ä–∏—Å—Ç—Ä—ñ–π ‚Äì –ü—Ä–æ—Ñ—ñ–ª—ñ: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–æ–¥–Ω–æ–≥–æ¬ª. –ö–æ–∂–µ–Ω –ø—Ä–æ—Ñ—ñ–ª—å
           –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏–π –¥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é;
     –¥)    –ü—Ä–∏—Å—Ç—Ä—ñ–π ‚Äì –¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª. –û–¥–∏–Ω –ø—Ä–∏—Å—Ç—Ä—ñ–π
           –≥–µ–Ω–µ—Ä—É—î –±–µ–∑–ª—ñ—á –∑–∞–ø–∏—Å—ñ–≤ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó.
     –î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö PostgreSQL –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ SQLx,
—è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø–∏—Å–∞—Ç–∏ ¬´—á–∏—Å—Ç—ñ¬ª SQL-–∑–∞–ø–∏—Ç–∏ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é —ó—Ö –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—ñ –Ω–∞ –µ—Ç–∞–ø—ñ
–∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó, —â–æ –º—ñ–Ω—ñ–º—ñ–∑—É—î —Ä–∏–∑–∏–∫ –ø–æ–º–∏–ª–æ–∫ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

     2.3 UML –¥—ñ–∞–≥—Ä–∞–º–∞ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ñ–≤

     –î–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏—Ö –≤–∏–º–æ–≥ –¥–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –±—É–ª–∞ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞
–¥—ñ–∞–≥—Ä–∞–º–∞ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ñ–≤ (Use Case Diagram). –í–æ–Ω–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –æ—Å–Ω–æ–≤–Ω–∏—Ö –¥—ñ–π–æ–≤–∏—Ö –æ—Å—ñ–±
(–∞–∫—Ç–æ—Ä—ñ–≤) —Ç–∞ —ó—Ö–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ —Å–∏—Å—Ç–µ–º–æ—é.
                                                                                                                      5

                                                                             –°–µ—Ä–≤–µ—Ä–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ LumiRum


                                                                                 –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤ —Å–∏—Å—Ç–µ–º—ñ


                                                                             –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏



                                                                          –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—ñ–¥–ª–µ–≥–ª–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

                           –í–ª–∞—Å–Ω–∏–∫

                         ¬´extends¬ª       (–Ø–∫—â–æ –ø—Ä–æ—Ñ—ñ–ª—å –ø—É–±–ª—ñ—á–Ω–∏–π)
                                                                         –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Å–µ–±–µ (Me)
             ¬´extends¬ª



                         –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
                                                                                –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è (Login)


                                                                           –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—è–º–∏ (Profiles)


                                                                             –ü–µ—Ä–µ–≥–ª—è–¥ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—ñ–≤




                                                                            –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è




                                                                         –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–°–æ–Ω/–ö–æ–ª—ñ—Ä)




                                                                          –ö–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ (Devices)
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á


                                                                             –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞




                                                                             –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é




                                                                           –ü—Ä–∏–≤'—è–∑–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é –¥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é




                                                                              –ü–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞–Ω—É –ø—Ä–∏—Å—Ç—Ä–æ—é




                                           (Auth via Secret Key)               –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å


                         IoT –ü—Ä–∏—Å—Ç—Ä—ñ–π
                                           (Auth via Secret Key)              –¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è —Ç–∞ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥



                                                                    –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –∑–¥–æ—Ä–æ–≤'—è —Å–µ—Ä–≤–µ—Ä–∞ (Health Check)




                                                                                –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó
                                                                              (–†—É—Ö, –°–≤—ñ—Ç–ª–æ, –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞)




                                                                                –ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–¥—ñ–π




             –†–∏—Å—É–Ω–æ–∫ 2.1 ‚Äì UML –¥—ñ–∞–≥—Ä–∞–º–∞ –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ñ–≤ —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏
                                                                                   6
     –ë–∞–∑–æ–≤–∞ —Ä–æ–ª—å –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞–¥–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —Å–∏—Å—Ç–µ–º–∏,
–≤–∫–ª—é—á–∞—é—á–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é, –ø–µ—Ä–µ–≥–ª—è–¥ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–ª–∞—Å–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å,
–∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—è–º–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏
—Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—ñ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ä–µ–∂–∏–º—É —Å–Ω—É —Ç–∞ –∫–æ–ª—å–æ—Ä–æ–≤–æ—ó
–ø–∞–ª—ñ—Ç—Ä–∏, —Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó, –ø—Ä–∏–≤‚Äô—è–∑—É–≤–∞—Ç–∏ –¥–æ –Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—ñ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è, –∞ —Ç–∞–∫–æ–∂
–ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å—Ç–∞–Ω –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—é —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö.
     –†–æ–ª—å     –í–ª–∞—Å–Ω–∏–∫–∞     —Ä–æ–∑—à–∏—Ä—é—î      —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª     –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞   –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏
–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–º–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏. –í–ª–∞—Å–Ω–∏–∫ –º–∞—î –ø—Ä–∞–≤–æ —Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤–∏—Ö
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É —Å–∏—Å—Ç–µ–º—ñ, —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø—ñ–¥–ª–µ–≥–ª—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏, –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ñ
–∫–ª—é—á—ñ –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤, –∞ —Ç–∞–∫–æ–∂ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ –ø—É–±–ª—ñ—á–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ
–æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è —Å–≤–æ—ó—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–∏—Å—Ç–µ–º–∏.
     –†–æ–ª—å –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —É—Å–ø–∞–¥–∫–æ–≤—É—î –≤—Å—ñ –ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–Ω—è –í–ª–∞—Å–Ω–∏–∫–∞ —Ç–∞ –Ω–∞–¥–∞—î
–Ω–∞–π–≤–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–∏—Å—Ç–µ–º–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ
–æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏.
     IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å —ñ–∑ —Å–µ—Ä–≤–µ—Ä–Ω–æ—é —á–∞—Å—Ç–∏–Ω–æ—é —á–µ—Ä–µ–∑ –∑–∞—Ö–∏—â–µ–Ω—ñ –∫–∞–Ω–∞–ª–∏
–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö —Å–µ–∫—Ä–µ—Ç–Ω–∏—Ö –∫–ª—é—á—ñ–≤. –ü—Ä–∏—Å—Ç—Ä–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å
—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ, —â–æ –≤–∫–ª—é—á–∞—é—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä—É—Ö, —Ä—ñ–≤–µ–Ω—å –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è —Ç–∞
—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –∞ —Ç–∞–∫–æ–∂ –æ—Ç—Ä–∏–º—É—é—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–∏—Ö
–ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è. –°–∏—Å—Ç–µ–º–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –ø–æ—Å—Ç—ñ–π–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ
—á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω—ñ–∑–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞–Ω—É –∑–¥–æ—Ä–æ–≤‚Äô—è —Å–µ—Ä–≤–µ—Ä–∞.

     2.4 ER –¥—ñ–∞–≥—Ä–∞–º–∞ –¥–∞–Ω–∏—Ö

     –ù–∞ –æ—Å–Ω–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑—É –ø—Ä–µ–¥–º–µ—Ç–Ω–æ—ó –æ–±–ª–∞—Å—Ç—ñ —Ç–∞ —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ—ó —Å—Ö–µ–º–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –±—É–ª–∞
—Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –¥—ñ–∞–≥—Ä–∞–º–∞ —Å—É—Ç–Ω–æ—Å—Ç–µ–π —Ç–∞ –∑–≤‚Äô—è–∑–∫—ñ–≤ (ER-–¥—ñ–∞–≥—Ä–∞–º–∞).
     –û—Å–Ω–æ–≤–Ω—ñ —Å—É—Ç–Ω–æ—Å—Ç—ñ —Å–∏—Å—Ç–µ–º–∏:
      –∞)   User (–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á): —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ —Å—É—Ç–Ω—ñ—Å—Ç—å, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –≤—Å—ñ—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤
           —Å–∏—Å—Ç–µ–º–∏ (–í–ª–∞—Å–Ω–∏–∫—ñ–≤, –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤).
     –±)    Profile (–ü—Ä–æ—Ñ—ñ–ª—å): –Ω–∞–±—ñ—Ä –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (—Ü–∏—Ä–∫–∞–¥–Ω—ñ
           —Ä–∏—Ç–º–∏, —Ç–∞–π–º—ñ–Ω–≥–∏).
      –≤)   Device (–ü—Ä–∏—Å—Ç—Ä—ñ–π): —Ñ—ñ–∑–∏—á–Ω–∏–π IoT-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä.
      –≥)   Telemetry (–¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è): —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ, —â–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å –≤—ñ–¥ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.
                                                                  7


                                            Telemetry (–ü–æ–¥—ñ—ó)

        User (–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á)                     id
                                              event_type
          id
                                              motion_detected
          username
                     –º–∞—î –ø—ñ–¥–ª–µ–≥–ª–∏—Ö            light_is_on
          password_hash
                                              brightness
          role
                                              color_temp
          created_at
                                              ambient_light
                                              created_at
     –≤–æ–ª–æ–¥—ñ—î
                            –≤–æ–ª–æ–¥—ñ—î

                                                  –≥–µ–Ω–µ—Ä—É—î
Profile (–ü—Ä–æ—Ñ—ñ–ª—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å)

  id
  name
                                          Device (IoT –ü—Ä–∏—Å—Ç—Ä—ñ–π)
  is_shared
  latitude                                 id
  longitude                                name
  timezone                                 secret_key
  sleep_start                              is_public
                                   –∫–æ–Ω—Ñ—ñ–≥—É—Ä—É—î
  sleep_end                                firmware_version
  night_mode_enabled                       last_seen
  min_color_temp                           created_at
  max_color_temp
  motion_timeout_seconds
  created_at

         –†–∏—Å—É–Ω–æ–∫ 2.2 ‚Äì ER –¥—ñ–∞–≥—Ä–∞–º–∞ –¥–∞–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∏ LumiRum
                                                                                8
     –ù–∞ –¥—ñ–∞–≥—Ä–∞–º—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ç–∏–ø–∏ –∑–≤‚Äô—è–∑–∫—ñ–≤:
     –∞)    User ‚Äì User (–†–µ–∫—É—Ä—Å–∏–≤–Ω–∏–π –∑–≤‚Äô—è–∑–æ–∫): –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —ñ—î—Ä–∞—Ä—Ö—ñ—é –∞–∫–∫–∞—É–Ω—Ç—ñ–≤.
           –û–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (–í–ª–∞—Å–Ω–∏–∫) –º–æ–∂–µ –º–∞—Ç–∏ –±–∞–≥–∞—Ç–æ –ø—ñ–¥–ª–µ–≥–ª–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
           (¬´parent_id¬ª –≤ –ë–î), –∞–ª–µ –ø—ñ–¥–ª–µ–≥–ª–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –Ω–∞–ª–µ–∂–∞—Ç–∏ –ª–∏—à–µ –æ–¥–Ω–æ–º—É
           –í–ª–∞—Å–Ω–∏–∫—É (–∞–±–æ –∂–æ–¥–Ω–æ–º—É, —è–∫—â–æ —Ü–µ —Å–∞–º –í–ª–∞—Å–Ω–∏–∫).
     –±)    User ‚Äì Profile: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª (1 : ùëÅ ). –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î
           –ø—Ä–æ—Ñ—ñ–ª—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å. –ê—Ç—Ä–∏–±—É—Ç ¬´is_shared¬ª —É —Å—É—Ç–Ω–æ—Å—Ç—ñ ¬´Profile¬ª –≤–∏–∑–Ω–∞—á–∞—î,
           —á–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥–ª–µ–≥–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –±–∞—á–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ—Ñ—ñ–ª—å.
     –≤)    User ‚Äì Device: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª (1 : ùëÅ ). –§—ñ–∑–∏—á–Ω—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó
           –∂–æ—Ä—Å—Ç–∫–æ –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω—ñ –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –í–ª–∞—Å–Ω–∏–∫–∞. –ê—Ç—Ä–∏–±—É—Ç ¬´is_public¬ª
           –≤–∏–∑–Ω–∞—á–∞—î, —á–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥–ª–µ–≥–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∫–µ—Ä—É–≤–∞—Ç–∏ —Ü–∏–º –ø—Ä–∏—Å—Ç—Ä–æ—î–º.
      –≥)   Profile ‚Äì Device: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª (0..1 : ùëÅ ). –û–¥–∏–Ω –ø—Ä–æ—Ñ—ñ–ª—å
           –º–æ–∂–µ –±—É—Ç–∏ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∏–π –¥–æ –±–∞–≥–∞—Ç—å–æ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–æ—Ñ—ñ–ª—å
           ¬´–°–ø–∞–ª—å–Ω—è¬ª –¥–ª—è –≤—Å—ñ—Ö –ª–∞–º–ø —É —Å–ø–∞–ª—å–Ω—è—Ö). –ü—Ä–∏—Å—Ç—Ä—ñ–π –º–æ–∂–µ –Ω–µ –º–∞—Ç–∏
           –ø—Ä–∏–≤‚Äô—è–∑–∞–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é (—Ç–æ–¥—ñ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î –≤ —Ä—É—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ), –∞–ª–µ –Ω–µ –º–æ–∂–µ
           –º–∞—Ç–∏ –±—ñ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é –æ–¥–Ω–æ—á–∞—Å–Ω–æ.
     –¥)    Device ‚Äì Telemetry: –ó–≤‚Äô—è–∑–æ–∫ ¬´–æ–¥–∏–Ω-–¥–æ-–±–∞–≥–∞—Ç—å–æ—Ö¬ª (1 : ùëÅ ). –ü—Ä–∏—Å—Ç—Ä—ñ–π
           –ø–æ—Å—Ç—ñ–π–Ω–æ –≥–µ–Ω–µ—Ä—É—î –ø–æ–¥—ñ—ó (–≤–∏—è–≤–ª–µ–Ω–Ω—è —Ä—É—Ö—É, –∑–º—ñ–Ω–∞ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ), —è–∫—ñ
           –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ –∂—É—Ä–Ω–∞–ª —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.

     2.5 –†–æ–∑—Ä–æ–±–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

     –ü—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –≤–∏–∫–æ–Ω—É–≤–∞–ª–æ—Å—è –º–µ—Ç–æ–¥–æ–º –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤—ñ–¥–Ω–æ—à–µ–Ω—å.
–¶–µ–π –ø—Ä–æ—Ü–µ—Å –¥–æ–∑–≤–æ–ª—è—î —É—Å—É–Ω—É—Ç–∏ –Ω–∞–¥–ª–∏—à–∫–æ–≤—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö, –∑–º–µ–Ω—à–∏—Ç–∏ —Ä–∏–∑–∏–∫ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è
–∞–Ω–æ–º–∞–ª—ñ–π –ø—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ —Ç–∞ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó. –í —è–∫–æ—Å—Ç—ñ –°–£–ë–î –æ–±—Ä–∞–Ω–æ
PostgreSQL.
     –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –µ—Ç–∞–ø–∏ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –¥—ñ–∞–≥—Ä–∞–º–∞–º–∏.

     2.5.1 –ü–µ—Ä—à–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞ (1NF)

     –ù–∞ –ø–µ—Ä—à–æ–º—É –µ—Ç–∞–ø—ñ –≤—Å—ñ –¥–∞–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ –º–æ–∂–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ —É –≤–∏–≥–ª—è–¥—ñ –æ–¥–Ω—ñ—î—ó –≤–µ–ª–∏–∫–æ—ó
—Ç–∞–±–ª–∏—Ü—ñ (¬´–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –∂—É—Ä–Ω–∞–ª¬ª).
     –í–∏–º–æ–≥–∏ 1NF:
                                                                              9
      ‚Äì   –£—Å—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω–∏–º–∏ (–Ω–µ–ø–æ–¥—ñ–ª—å–Ω–∏–º–∏).
      ‚Äì   –í —Ç–∞–±–ª–∏—Ü—ñ –Ω–µ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≥—Ä—É–ø, —â–æ –ø–æ–≤—Ç–æ—Ä—é—é—Ç—å—Å—è.
      ‚Äì   –£—Å—ñ —Ä—è–¥–∫–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏.
     –£ –Ω–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫–±–∏ –º–∏ –∑–±–µ—Ä—ñ–≥–∞–ª–∏ –≤—Å–µ –≤ –æ–¥–Ω—ñ–π —Ç–∞–±–ª–∏—Ü—ñ ¬´System_Log¬ª,
–º–∏ –± –º–∞–ª–∏ –≤–µ–ª–∏—á–µ–∑–Ω—É –Ω–∞–¥–ª–∏—à–∫–æ–≤—ñ—Å—Ç—å. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó
(—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, —Ä—É—Ö) –¥–æ–≤–æ–¥–∏–ª–æ—Å—è –± –¥—É–±–ª—é–≤–∞—Ç–∏ —ñ–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –ø–∞—Ä–æ–ª—å, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
–ø—Ä–æ—Ñ—ñ–ª—é –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è —Ç–æ—â–æ:



                           System_Universal_Log

                            id (PK)
                         timestamp
                                User Info
                         user_name
                         user_password_hash
                         user_role
                         parent_user_name
                               Device Info
                         device_name
                         device_secret_key
                         device_firmware
                                Profile Info
                         profile_name
                         profile_color_temp_min
                         profile_color_temp_max
                         profile_sleep_time
                             Telemetry Data
                         event_type
                         motion_detected
                         brightness_level
                         ambient_light_sensor

            –†–∏—Å—É–Ω–æ–∫ 2.3 ‚Äì –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É 1NF (–î–µ–Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞)
                                                                              10
     –ù–µ–¥–æ–ª—ñ–∫–∏ 1NF:
      ‚Äì   –ê–Ω–æ–º–∞–ª—ñ—è –≤—Å—Ç–∞–≤–∫–∏: –ù–µ–º–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –ø–æ–∫–∏ –≤—ñ–Ω –Ω–µ –º–∞—î
          –ø—Ä–∏—Å—Ç—Ä–æ—é —Ç–∞ –ø–æ–¥—ñ–π —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó.
      ‚Äì   –ê–Ω–æ–º–∞–ª—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: –©–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é, —Ç—Ä–µ–±–∞
          –æ–Ω–æ–≤–∏—Ç–∏ –º—ñ–ª—å–π–æ–Ω–∏ —Ä—è–¥–∫—ñ–≤ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó.
      ‚Äì   –ù–∞–¥–ª–∏—à–∫–æ–≤—ñ—Å—Ç—å: –î–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª—å –∑–∞–π–º–∞—é—Ç—å 90% –æ–±‚Äô—î–º—É
          –ë–î.

     2.5.2 –î—Ä—É–≥–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞ (2NF)

     –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –¥–æ 2NF –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ, —â–æ–± —Ç–∞–±–ª–∏—Ü—è –±—É–ª–∞ –≤ 1NF —ñ –≤—Å—ñ –Ω–µ–∫–ª—é—á–æ–≤—ñ
–∞—Ç—Ä–∏–±—É—Ç–∏ –∑–∞–ª–µ–∂–∞–ª–∏ –≤—ñ–¥ –ø–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞ (–∞ –Ω–µ –≤—ñ–¥ –π–æ–≥–æ —á–∞—Å—Ç–∏–Ω–∏).
     –ú–∏ —Ä–æ–∑–¥—ñ–ª–∏–ª–∏ –¥–∞–Ω—ñ –Ω–∞ –ª–æ–≥—ñ—á–Ω—ñ –≥—Ä—É–ø–∏. –¢–µ–ø–µ—Ä ¬´Telemetry¬ª –∑–∞–ª–µ–∂–∏—Ç—å –ª–∏—à–µ –≤—ñ–¥ ID
–ø–æ–¥—ñ—ó, –∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ –¥–∞–Ω—ñ –≤–∏–Ω–µ—Å–µ–Ω–æ –æ–∫—Ä–µ–º–æ. –û–¥–Ω–∞–∫, —É –ø—Ä–æ–º—ñ–∂–Ω—ñ–π —Å—Ö–µ–º—ñ –Ω–∏–∂—á–µ –º–∏
–≤—Å–µ —â–µ –±–∞—á–∏–º–æ –ø—Ä–æ–±–ª–µ–º—É: –≤ —Ç–∞–±–ª–∏—Ü—ñ ¬´Devices¬ª –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
(¬´profile_settings¬ª), —â–æ —Å—Ç–≤–æ—Ä—é—î –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ —ñ–º–µ–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—é, –∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥ ID
–ø—Ä–∏—Å—Ç—Ä–æ—é.


   Devices_With_Config

    device_id
    device_name                      Telemetry
                                                                 Users
    secret_key                       telemetry_id
                                                             user_id
  owner_id (FK)                   device_id (FK)             username
 Transitive Dependency            timestamp                  password_hash
 profile_name                     event_type                 role
 profile_min_temp                 sensor_values
 profile_max_temp
 sleep_start_time

          –†–∏—Å—É–Ω–æ–∫ 2.4 ‚Äì –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É 2NF (–ß–∞—Å—Ç–∫–æ–≤–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è)

     –ü—Ä–æ–±–ª–µ–º–∞, —â–æ –∑–∞–ª–∏—à–∏–ª–∞—Å—å: —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å, –∞—Ç—Ä–∏–±—É—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—é
(¬´profile_min_temp¬ª —Ç–∞ —ñ–Ω.) –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ —Å—É—Ç–Ω–æ—Å—Ç—ñ ¬´–ü—Ä–æ—Ñ—ñ–ª—å¬ª, —è–∫–∞ ¬´—Å—Ö–æ–≤–∞–Ω–∞¬ª
                                                                               11
–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ ¬´Devices¬ª. –Ø–∫—â–æ –¥–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –æ–¥–∏–Ω –ø—Ä–æ—Ñ—ñ–ª—å, –¥–∞–Ω—ñ
–¥—É–±–ª—é—é—Ç—å—Å—è.

     2.5.3 –¢—Ä–µ—Ç—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞ (3NF)

     –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –¥–æ 3NF –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —É—Å—É–Ω—É—Ç–∏ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ. –ê—Ç—Ä–∏–±—É—Ç–∏
–ø–æ–≤–∏–Ω–Ω—ñ –∑–∞–ª–µ–∂–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤—ñ–¥ –ø–µ—Ä–≤–∏–Ω–Ω–æ–≥–æ –∫–ª—é—á–∞.
     –ú–∏ –≤–∏–Ω–µ—Å–ª–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –≤ –æ–∫—Ä–µ–º—É —Ç–∞–±–ª–∏—Ü—é ¬´Profiles¬ª. –¢–µ–ø–µ—Ä
¬´Devices¬ª –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ ¬´Profiles¬ª —á–µ—Ä–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –∫–ª—é—á ¬´profile_id¬ª. –¶–µ —Ñ—ñ–Ω–∞–ª—å–Ω–∞
—Å—Ö–µ–º–∞, —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –≤ SQL.


                             profiles

                      id : BIGSERIAL                       telemetry
                    owner_id : BIGINT (FK)          id : BIGSERIAL
                    name : TEXT
                                                  device_id : BIGINT (FK)
                    is_shared : BOOLEAN
                                                  event_type : TEXT
                            Settings
                                                  motion_detected : BOOLEAN
                    latitude : DOUBLE
                                                  light_is_on : BOOLEAN
                    longitude : DOUBLE
                                                  brightness : SMALLINT
                    sleep_start : TIME
                                                  color_temp : SMALLINT
                    sleep_end : TIME
                                                  ambient_light : SMALLINT
                    min_color_temp : INT
                                                  created_at : TIMESTAMPTZ
                    max_color_temp : INT
                    motion_timeout : INT
                                                       device_id
                  owner_id

                               profile_id
                                                            devices
                            users
                                                      id : BIGSERIAL
                  id : BIGSERIAL
                                                  owner_id : BIGINT (FK)
                username : TEXT
                                                  profile_id : BIGINT (FK)
                password_hash : TEXT     owner_id
                                                  name : TEXT
   parent_id    role : ENUM
                                                  secret_key : TEXT
                parent_id : BIGINT (FK)
                                                  is_public : BOOLEAN
                created_at : TIMESTAMPTZ
                                                  last_seen : TIMESTAMPTZ


           –†–∏—Å—É–Ω–æ–∫ 2.5 ‚Äì –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —É 3NF (–§—ñ–Ω–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
                                                                                 12
     –£ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ—Ç—Ä–∏–º–∞–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –¥–µ:
      –∞)   –¢–∞–±–ª–∏—Ü—è ¬´users¬ª –∑–±–µ—Ä—ñ–≥–∞—î —ñ—î—Ä–∞—Ä—Ö—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
     –±)    –¢–∞–±–ª–∏—Ü—è ¬´profiles¬ª –∑–±–µ—Ä—ñ–≥–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –Ω–∞ —è–∫—ñ –º–æ–∂—É—Ç—å
           –ø–æ—Å–∏–ª–∞—Ç–∏—Å—è —Ä—ñ–∑–Ω—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó.
      –≤)   –¢–∞–±–ª–∏—Ü—è ¬´devices¬ª –ø–æ–≤‚Äô—è–∑—É—î —Ñ—ñ–∑–∏—á–Ω–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –∑ –≤–ª–∞—Å–Ω–∏–∫–æ–º —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª–µ–º.
      –≥)   –¢–∞–±–ª–∏—Ü—è ¬´telemetry¬ª –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ —ñ—Å—Ç–æ—Ä–∏—á–Ω—ñ –¥–∞–Ω—ñ –ø–æ–¥—ñ–π.
     –¢–∞–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞–Ω–æ–º–∞–ª—ñ–π —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
–¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É.

     2.6 –§—ñ–∑–∏—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

     –ù–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ —Ñ—ñ–∑–∏—á–Ω—É —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è
–°–£–ë–î PostgreSQL.
     –î—ñ–∞–≥—Ä–∞–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —â–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç–∞–±–ª–∏—Ü—ñ, —Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö, –ø–µ—Ä–≤–∏–Ω–Ω—ñ
—Ç–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ –∫–ª—é—á—ñ, –Ω–∞–≤–µ–¥–µ–Ω–∞ –Ω–∏–∂—á–µ. SQL-–∫–æ–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ü—ñ—î—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–π
–≤ –¥–æ–¥–∞—Ç–∫—É –ë.

     2.7 –†–æ–∑—Ä–æ–±–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π —Ä–æ–±–æ—Ç–∏ –∑ –ë–î

     –î–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö —É –ø—Ä–æ–µ–∫—Ç—ñ –±—É–ª–æ –æ–±—Ä–∞–Ω–æ –ø—ñ–¥—Ö—ñ–¥ Custom ORM
(CoRM) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ ¬´sqlx¬ª. –ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö ORM,
—è–∫—ñ –∞–±—Å—Ç—Ä–∞–≥—É—é—Ç—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ –≤—ñ–¥ SQL, ¬´sqlx¬ª –¥–æ–∑–≤–æ–ª—è—î –ø–∏—Å–∞—Ç–∏ —á–∏—Å—Ç—ñ SQL-–∑–∞–ø–∏—Ç–∏,
–∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –ø—Ä–∏ —Ü—å–æ–º—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —ó—Ö —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ç–∏–ø–∞–º –¥–∞–Ω–∏—Ö Rust
–Ω–∞ –µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø–æ—î–¥–Ω–∞—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ SQL –∑ –±–µ–∑–ø–µ–∫–æ—é
—Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–æ—ó –º–æ–≤–∏.
     –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è CRUD-–æ–ø–µ—Ä–∞—Ü—ñ–π –≤–∏–∫–æ–Ω–∞–Ω–∞ —É –≤–∏–≥–ª—è–¥—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∏—Ö
—Ñ—É–Ω–∫—Ü—ñ–π    –¥–ª—è   —Å—Ç—Ä—É–∫—Ç—É—Ä    –º–æ–¥–µ–ª–µ–π      –¥–∞–Ω–∏—Ö.   –ú–µ—Ç–æ–¥–∏    —á–∏—Ç–∞–Ω–Ω—è   (¬´get_by_id¬ª,
¬´list_as_owner¬ª) –º—ñ—Å—Ç—è—Ç—å –≤–±—É–¥–æ–≤–∞–Ω—É –ª–æ–≥—ñ–∫—É —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —â–æ
–¥–æ–∑–≤–æ–ª—è—î –≤–∏–±–∏—Ä–∞—Ç–∏ –ª–∏—à–µ —Ç—ñ –∑–∞–ø–∏—Å–∏, –¥–æ —è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –¥–æ—Å—Ç—É–ø –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ
—Å–≤–æ—î—ó —Ä–æ–ª—ñ —Ç–∞ —ñ—î—Ä–∞—Ä—Ö—ñ—ó –ø—ñ–¥–ø–æ—Ä—è–¥–∫—É–≤–∞–Ω–Ω—è.
     –û—Å–æ–±–ª–∏–≤—É —É–≤–∞–≥—É –ø—Ä–∏–¥—ñ–ª–µ–Ω–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –æ–ø–µ—Ä–∞—Ü—ñ–π –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö (¬´update¬ª —Ç–∞
¬´delete¬ª). –î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ
–ø–∞—Ç–µ—Ä–Ω —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó. –ú–µ—Ç–æ–¥ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                                                                                  13
—Å–ø–æ—á–∞—Ç–∫—É –≤—ñ–¥–∫—Ä–∏–≤–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∑–∞–ø–∏—Å —ñ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º —Ä—è–¥–∫–∞ (¬´FOR
UPDATE¬ª). –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞–Ω–µ —É –º–µ—Ç–æ–¥ –∑–∞–º–∏–∫–∞–Ω–Ω—è (closure), —è–∫–µ
–º—ñ—Å—Ç–∏—Ç—å –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ–ª—ñ–≤ –æ–±‚Äô—î–∫—Ç–∞ –≤ –ø–∞–º‚Äô—è—Ç—ñ.
–¢—ñ–ª—å–∫–∏ —è–∫—â–æ –∑–∞–º–∏–∫–∞–Ω–Ω—è –ø–æ–≤–µ—Ä—Ç–∞—î —É—Å–ø—ñ—à–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —ñ –¥–∞–Ω—ñ –¥—ñ–π—Å–Ω–æ –∑–º—ñ–Ω–∏–ª–∏—Å—è,
–≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è SQL-–∑–∞–ø–∏—Ç ¬´UPDATE¬ª. –¢–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –≥–∞—Ä–∞–Ω—Ç—É—î –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü—ñ–π —Ç–∞
–∑–∞–ø–æ–±—ñ–≥–∞—î —Å–∏—Ç—É–∞—Ü—ñ—è–º, –∫–æ–ª–∏ –ª–æ–≥—ñ–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –ø—Ä–∏–π–º–∞—î —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏—Ö
–¥–∞–Ω–∏—Ö.
      –î–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å–æ–º —É –±–∞–∑—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞
¬´garde¬ª, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –æ–ø–∏—Å—É–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (–¥–æ–≤–∂–∏–Ω–∞ —Ä—è–¥–∫—ñ–≤,
–¥—ñ–∞–ø–∞–∑–æ–Ω–∏ –∑–Ω–∞—á–µ–Ω—å) –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —É —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –¥–∞–Ω–∏—Ö (DTO).
      –ü—Ä–∏–∫–ª–∞–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º–æ–¥–µ–ª—ñ ¬´Profile¬ª –Ω–∞–≤–µ–¥–µ–Ω–æ –≤ –¥–æ–¥–∞—Ç–∫—É –í:

      2.8 –†–æ–∑—Ä–æ–±–∫–∞ —Ç–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è API

      –î–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó –º—ñ–∂ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–º–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞–º–∏ (–≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å,
IoT-–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏) —Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ—é —á–∞—Å—Ç–∏–Ω–æ—é –±—É–ª–æ –æ–±—Ä–∞–Ω–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π —Å—Ç–∏–ª—å REST
(Representational State Transfer).
      –í–∏–±—ñ—Ä REST –∑—É–º–æ–≤–ª–µ–Ω–∏–π –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏:
      –∞)   –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω—ñ—Å—Ç—å: –ü—Ä–æ—Ç–æ–∫–æ–ª HTTP –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –≤—Å—ñ–º–∞ —Å—É—á–∞—Å–Ω–∏–º–∏
           –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏, –≤–∫–ª—é—á–∞—é—á–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ (embedded systems), –Ω–∞ —è–∫–∏—Ö
           –±–∞–∑—É—é—Ç—å—Å—è IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó (ESP32).
      –±)   –ë–µ–∑—Å—Ç–∞–Ω—ñ–≤—Å—Ç—å (Stateless): –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î —Å—Ç–∞–Ω —Å–µ—Å—ñ—ó –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏,
           —â–æ —Å–ø—Ä–æ—â—É—î –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ –ø—Ä–∏ –Ω–µ—Å—Ç–∞–±—ñ–ª—å–Ω–æ–º—É
           –∑‚Äô—î–¥–Ω–∞–Ω–Ω—ñ.
      –≤)   –ö–µ—à—É–≤–∞–Ω–Ω—è: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö HTTP-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤ –¥–æ–∑–≤–æ–ª—è—î
           –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–µ—à—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞.
      –≥)   –§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è JSON —è–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É –æ–±–º—ñ–Ω—É –¥–∞–Ω–∏–º–∏
           –∑–∞–±–µ–∑–ø–µ—á—É—î –ª–µ–≥–∫—ñ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥—É —Ç–∞ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å.
      –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏, —Ç–∞–∫—ñ —è–∫ GraphQL –∞–±–æ gRPC, –±—É–ª–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω—ñ: GraphQL –Ω–∞–¥–º—ñ—Ä–Ω–∏–π
–¥–ª—è IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ —á–µ—Ä–µ–∑ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –º–æ–≤—ñ C/Rust –Ω–∞
–º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ, –∞ gRPC –ø–æ—Ç—Ä–µ–±—É—î –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫, —è–∫—ñ –º–æ–∂—É—Ç—å
–±—É—Ç–∏ –≤–∞–∂–∫–∏–º–∏ –¥–ª—è –æ–±–º–µ–∂–µ–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ ESP32.
                                                                              14
     2.8.1 –ú–µ—Ç–æ–¥–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

     API –ø—ñ–¥—Ç—Ä–∏–º—É—î –¥–≤–∞ —Ç–∏–ø–∏ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:
     –∞)   User Authentication (JWT): –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –í–ª–∞—Å–Ω–∏–∫,
          –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç ¬´Bearer Token¬ª. –¢–æ–∫–µ–Ω –≤–∏–¥–∞—î—Ç—å—Å—è
          –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –≤—Ö–æ–¥—É —Ç–∞ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É ¬´Authorization¬ª.
     –±)   Device Authentication (API Key): IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó –Ω–µ –º–∞—é—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ
          —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –¥–ª—è –ª–æ–≥—ñ–Ω—É, —Ç–æ–º—É –≤–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Å–µ–∫—Ä–µ—Ç–Ω–∏–π
          –∫–ª—é—á (¬´secret_key¬ª), —è–∫–∏–π –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫—É ¬´x-api-key¬ª.
     –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—é –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ API –∑ –æ–ø–∏—Å–æ–º –º–µ—Ç–æ–¥—ñ–≤,
–≤—Ö—ñ–¥–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.

     2.8.2 –ì—Ä—É–ø–∞ ¬´–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è¬ª (¬´/auth¬ª)

     –ó–∞–±–µ–∑–ø–µ—á—É—î –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏ —Ç–∞ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏.
     –∞)   –í—Ö—ñ–¥ —É —Å–∏—Å—Ç–µ–º—É
      ‚Äì   –ú–µ—Ç–æ–¥: ¬´POST /auth/login¬ª
      ‚Äì   –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö —Ç–∞ –≤–∏–¥–∞—á–∞ JWT-—Ç–æ–∫–µ–Ω–∞.
      ‚Äì   –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É: JSON –∑ –ø–æ–ª—è–º–∏ ¬´username¬ª —Ç–∞ ¬´password¬ª.
      ‚Äì   –í—ñ–¥–ø–æ–≤—ñ–¥—å: –û–±‚Äô—î–∫—Ç ¬´AuthResponse¬ª, —â–æ –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ
          –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –π–æ–≥–æ —Ä–æ–ª—å —Ç–∞ —Ä—è–¥–æ–∫ ¬´token¬ª.
     –±)   –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è
      ‚Äì   –ú–µ—Ç–æ–¥: ¬´POST /auth/register¬ª
      ‚Äì   –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
      ‚Äì   –û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å: –Ø–∫—â–æ –∑–∞–ø–∏—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –±–µ–∑ —Ç–æ–∫–µ–Ω–∞, —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π
          ¬´–í–ª–∞—Å–Ω–∏–∫¬ª. –Ø–∫—â–æ –∑–∞–ø–∏—Ç —Ä–æ–±–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –í–ª–∞—Å–Ω–∏–∫, —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è
          –ø—ñ–¥–ª–µ–≥–ª–∏–π ¬´–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á¬ª.
      ‚Äì   –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É: ¬´username¬ª, ¬´password¬ª (–º—ñ–Ω. 8 —Å–∏–º–≤–æ–ª—ñ–≤).
      ‚Äì   –í—ñ–¥–ø–æ–≤—ñ–¥—å: 201 Created, –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ —Ç–æ–∫–µ–Ω.
     –≤)   –ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
      ‚Äì   –ú–µ—Ç–æ–¥: ¬´GET /auth/me¬ª ‚Äì –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–ª–∞—Å–Ω–∏–π –∞–∫–∞—É–Ω—Ç.
      ‚Äì   –ú–µ—Ç–æ–¥: ¬´PATCH /auth/me¬ª ‚Äì –ó–º—ñ–Ω–∞ –ø–∞—Ä–æ–ª—è –∞–±–æ —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
                                                                            15
‚Äì    –ú–µ—Ç–æ–¥: ¬´DELETE /auth/me¬ª ‚Äì –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
     –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞).

2.8.3 –ì—Ä—É–ø–∞ ¬´–ü—Ä–∏—Å—Ç—Ä–æ—ó¬ª (¬´/devices¬ª)

–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Ñ—ñ–∑–∏—á–Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞–º–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è.
–∞)   –ú–µ—Ç–æ–¥: ¬´GET /devices¬ª ‚Äì –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤. –í–ª–∞—Å–Ω–∏–∫ –±–∞—á–∏—Ç—å —Å–≤–æ—ó
     —Ç–∞ –ø—É–±–ª—ñ—á–Ω—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó —Å–≤–æ—ó—Ö –ø—ñ–¥–ª–µ–≥–ª–∏—Ö. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å–≤–æ—ó —Ç–∞ –ø—É–±–ª—ñ—á–Ω—ñ
     –ø—Ä–∏—Å—Ç—Ä–æ—ó –í–ª–∞—Å–Ω–∏–∫–∞.
–±)   –ú–µ—Ç–æ–¥: ¬´POST /devices¬ª
     –í—ñ–¥–ø–æ–≤—ñ–¥—å: –ü–æ–≤–µ—Ä—Ç–∞—î –æ–±‚Äô—î–∫—Ç –ø—Ä–∏—Å—Ç—Ä–æ—é, –≤–∫–ª—é—á–∞—é—á–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π
     ¬´secret_key¬ª, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±–µ—Ä–µ–≥—Ç–∏ –Ω–∞ IoT-–ø—Ä–∏—Å—Ç—Ä–æ—ó.
     –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:
     1)   ¬´name¬ª: –ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é (–Ω–∞–ø—Ä. ¬´–ö—É—Ö–Ω—è¬ª).
     2)   ¬´is_public¬ª: –ß–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏–º–∏ —á–ª–µ–Ω–∞–º–∏
          –≥—Ä—É–ø–∏.
     3)   ¬´profile_id¬ª: ID –ø—Ä–æ—Ñ—ñ–ª—é –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ).
–≤)   –ú–µ—Ç–æ–¥: ¬´POST /devices/{id}/key¬ª ‚Äì –†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–æ–≥–æ
     —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é. –°—Ç–∞—Ä–∏–π –∫–ª—é—á –º–∏—Ç—Ç—î–≤–æ —Å—Ç–∞—î –Ω–µ–¥—ñ–π—Å–Ω–∏–º.

2.8.4 –ì—Ä—É–ø–∞ ¬´–ü—Ä–æ—Ñ—ñ–ª—ñ¬ª (¬´/profiles¬ª)

–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ü–∏—Ä–∫–∞–¥–Ω–∏—Ö —Ä–∏—Ç–º—ñ–≤ —Ç–∞ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è.
–ú–µ—Ç–æ–¥–∏: ¬´GET¬ª, ¬´POST¬ª, ¬´PUT¬ª, ¬´DELETE¬ª –¥–ª—è —Ä–µ—Å—É—Ä—Å—É ¬´/profiles¬ª.
–¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É (Profile Object):
‚Äì    ¬´name¬ª: –ù–∞–∑–≤–∞ –ø—Ä–æ—Ñ—ñ–ª—é.
‚Äì    ¬´timezone¬ª: –ß–∞—Å–æ–≤–∏–π –ø–æ—è—Å (–Ω–∞–ø—Ä. ¬´Europe/Kyiv¬ª).
‚Äì    ¬´latitude¬ª, ¬´longitude¬ª: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Å—Ö–æ–¥—É/–∑–∞—Ö–æ–¥—É —Å–æ–Ω—Ü—è.
‚Äì    ¬´sleep_start¬ª,   ¬´sleep_end¬ª:   –ß–∞—Å   –ø–æ—á–∞—Ç–∫—É   —Ç–∞   –∫—ñ–Ω—Ü—è   —Å–Ω—É   (—Ñ–æ—Ä–º–∞—Ç
     ¬´HH:MM:SS¬ª).
‚Äì    ¬´min_color_temp¬ª, ¬´max_color_temp¬ª: –î—ñ–∞–ø–∞–∑–æ–Ω —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä —Å–≤—ñ—Ç–ª–∞ (1800K
     - 10000K).
‚Äì    ¬´motion_timeout_seconds¬ª: –ß–∞—Å —Ä–æ–±–æ—Ç–∏ —Å–≤—ñ—Ç–ª–∞ –ø—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ä—É—Ö—É.
                                                                                16
         ‚Äì   ¬´night_mode_enabled¬ª: –ß–∏ –≤–º–∏–∫–∞—Ç–∏ —á–µ—Ä–≤–æ–Ω–µ —Å–≤—ñ—Ç–ª–æ –≤–Ω–æ—á—ñ.

         2.8.5 –ì—Ä—É–ø–∞ ¬´–¢–µ–ª–µ–º–µ—Ç—Ä—ñ—è¬ª (¬´/telemetry¬ª)

         –ó–±—ñ—Ä —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö –∑ –¥–∞—Ç—á–∏–∫—ñ–≤.
         –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó (–¥–ª—è IoT)
         ‚Äì   –ú–µ—Ç–æ–¥: ¬´POST /telemetry¬ª
         ‚Äì   –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è: –¢—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ ¬´x-api-key¬ª.
         ‚Äì   –¢—ñ–ª–æ –∑–∞–ø–∏—Ç—É:
                   ‚Äì   ¬´event_type¬ª: –¢–∏–ø –ø–æ–¥—ñ—ó (–Ω–∞–ø—Ä. ¬´motion_detected¬ª).
                   ‚Äì   ¬´motion_detected¬ª: –ë—É–ª–µ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è.
                   ‚Äì   ¬´brightness¬ª: –ü–æ—Ç–æ—á–Ω–∞ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å (0-100).
                   ‚Äì   ¬´color_temp¬ª: –ü–æ—Ç–æ—á–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞.
                   ‚Äì   ¬´ambient_light¬ª: –ó–Ω–∞—á–µ–Ω–Ω—è –∑ –¥–∞—Ç—á–∏–∫–∞ –æ—Å–≤—ñ—Ç–ª–µ–Ω–æ—Å—Ç—ñ.
         –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
         ‚Äì   –ú–µ—Ç–æ–¥: ¬´GET /telemetry¬ª —Ç–∞ ¬´GET /telemetry/device/{id}¬ª
         ‚Äì   –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞–ø–∏—Ç—É (Query Params):
                   ‚Äì   ¬´start¬ª: –ü–æ—á–∞—Ç–∫–æ–≤–∞ –¥–∞—Ç–∞ (ISO 8601).
                   ‚Äì   ¬´end¬ª: –ö—ñ–Ω—Ü–µ–≤–∞ –¥–∞—Ç–∞ (ISO 8601).

         2.8.6 –°–∏—Å—Ç–µ–º–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏

         –ú–µ—Ç–æ–¥: ¬´GET /health¬ª ‚Äì –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–æ—Å—Ç—ñ —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –ë–î.
–ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç–∞—Ç—É—Å ¬´healthy¬ª –∞–±–æ ¬´no_database_connection¬ª.

         2.8.7 –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è API

         –ù–∏–∂—á–µ –Ω–∞–≤–µ–¥–µ–Ω–æ –ø—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è, —è–∫–∏–π
–¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Ñ–æ—Ä–º–∞—Ç JSON —Ç–∞ —Ç–∏–ø–∏ –¥–∞–Ω–∏—Ö.
         –ó–∞–ø–∏—Ç:

 1   POST /profiles HTTP/1.1
 2   Host: api.lumirum.com
 3   Authorization: Bearer <jwt_token>
 4   Content-Type: application/json
 5
 6   {
                                                                             17

 7   "name": "–î–æ–º–∞—à–Ω—ñ–π –∑–∞—Ç–∏—à–æ–∫",
 8   "is_shared": true,
 9   "timezone": "Europe/Kyiv",
10   "sleep_start": "23:00:00",
11   "sleep_end": "07:30:00",
12   "night_mode_enabled": true,
13   "min_color_temp": 2700,
14   "max_color_temp": 6000,
15   "motion_timeout_seconds": 300
16 }


     –£—Å–ø—ñ—à–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (201 Created):

 1 {
 2   "id": 42,
 3   "owner_id": 10,
 4   "name": "–î–æ–º–∞—à–Ω—ñ–π –∑–∞—Ç–∏—à–æ–∫",
 5   "is_shared": true,
 6   "created_at": "2024-05-20T14:30:00Z",
 7   "sleep_start": "23:00:00",
 8   "sleep_end": "07:30:00",
 9   "min_color_temp": 2700,
10   "max_color_temp": 6000,
11   "timezone": "Europe/Kyiv"
12   // –Ü–Ω—à—ñ –ø–æ–ª—è –ø—Ä–æ–ø—É—â–µ–Ω—ñ –¥–ª—è —Å—Ç–∏—Å–ª–æ—Å—Ç—ñ
13 }


     2.9 –í–∏—Å–Ω–æ–≤–∫–∏

     –ü—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –±—É–ª–æ —É—Å–ø—ñ—à–Ω–æ —Å–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ
—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–µ—Ä–≤–µ—Ä–Ω—É —á–∞—Å—Ç–∏–Ω—É —Å–∏—Å—Ç–µ–º–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
¬´LumiRum¬ª. –û—Å–Ω–æ–≤–Ω–∞ —É–≤–∞–≥–∞ –ø—Ä–∏–¥—ñ–ª—è–ª–∞—Å—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—é –Ω–∞–¥—ñ–π–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏,
–ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—é –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ —Ä–æ–∑—Ä–æ–±—Ü—ñ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.
     –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —Å–µ—Ä–≤–µ—Ä–Ω—É —á–∞—Å—Ç–∏–Ω—É –Ω–∞ –º–æ–≤—ñ Rust —ñ–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É
Axum. –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏—Ö –∑—Ä—ñ–∑—ñ–≤ (Vertical Slice Architecture)
–¥–æ–∑–≤–æ–ª–∏–ª–æ –¥–æ—Å—è–≥—Ç–∏ –≤–∏—Å–æ–∫–æ—ó –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—ñ –∫–æ–¥—É —Ç–∞ —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏.
     –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –º–æ–≤–∏ UML –±—É–ª–æ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥—ñ–∞–≥—Ä–∞–º—É –ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç—ñ–≤, —è–∫–∞
—á—ñ—Ç–∫–æ —Ä–æ–∑–º–µ–∂—É–≤–∞–ª–∞ –∑–æ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –º—ñ–∂ —Ä–æ–ª—è–º–∏ (–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –í–ª–∞—Å–Ω–∏–∫,
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á, –ü—Ä–∏—Å—Ç—Ä—ñ–π). ER-–¥—ñ–∞–≥—Ä–∞–º–∞ –¥–æ–∑–≤–æ–ª–∏–ª–∞ –≤—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–∏—Ö —Ç–∞
–∑–≤‚Äô—è–∑–∫–∏ –º—ñ–∂ —Å—É—Ç–Ω–æ—Å—Ç—è–º–∏.
     –°–ø—Ä–æ–µ–∫—Ç–æ–≤–∞–Ω–æ —Å—Ö–µ–º—É –±–∞–∑–∏ –¥–∞–Ω–∏—Ö PostgreSQL, –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —ó—ó –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–æ
—Ç—Ä–µ—Ç—å–æ—ó –Ω–æ—Ä–º–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏ (3NF), —â–æ –∑–∞–±–µ–∑–ø–µ—á–∏–ª–æ —É—Å—É–Ω–µ–Ω–Ω—è –Ω–∞–¥–ª–∏—à–∫–æ–≤–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö —Ç–∞
—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π.
                                                                             18
      –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —à–∞—Ä –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö (Data Access Layer) –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º
–±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ ¬´sqlx¬ª. –¶–µ –¥–æ–∑–≤–æ–ª–∏–ª–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω—ñ SQL-–∑–∞–ø–∏—Ç–∏ –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞
–µ—Ç–∞–ø—ñ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó. –û—Å–æ–±–ª–∏–≤—É —É–≤–∞–≥—É –ø—Ä–∏–¥—ñ–ª–µ–Ω–æ –±–µ–∑–ø–µ—Ü—ñ –¥–∞–Ω–∏—Ö: —ñ–º–ø–ª–µ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ –ø–∞—Ç–µ—Ä–Ω
—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è–º (¬´FOR UPDATE¬ª) –¥–ª—è –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω–∞–º
–≥–æ–Ω–∏—Ç–≤–∏ (race conditions).
      –°—Ç–≤–æ—Ä–µ–Ω–æ RESTful API, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –≤–∑–∞—î–º–æ–¥—ñ—é –º—ñ–∂ —Å–µ—Ä–≤–µ—Ä–æ–º, –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–º–∏
–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞–º–∏ —Ç–∞ IoT-–ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏. –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≥–Ω—É—á–∫—É —Å–∏—Å—Ç–µ–º—É –±–µ–∑–ø–µ–∫–∏, —â–æ –≤–∫–ª—é—á–∞—î
JWT-–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Å–µ–∫—Ä–µ—Ç–Ω–∏—Ö –∫–ª—é—á—ñ–≤ (API Key) –¥–ª—è
–ø—Ä–∏—Å—Ç—Ä–æ—ó–≤. –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—è API –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É OpenAPI.
      –û—Ç—Ä–∏–º–∞–Ω—ñ –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ —Ä–æ–±–æ—Ç–∏ –∑ —Å—É—á–∞—Å–Ω–∏–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—è–º–∏ (Rust, Docker,
PostgreSQL) —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–µ–∫—Ç—É–≤–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª–∏–ª–∏ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—É
–æ—Å–Ω–æ–≤—É –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ —Ä–æ–∑–≤–∏—Ç–∫—É –ø—Ä–æ–µ–∫—Ç—É ¬´LumiRum¬ª.
                                                         19
                                   –î–û–î–ê–¢–û–ö –ê
                                     –í—ñ–¥–µ–æ–∑–∞–ø–∏—Å

     –í—ñ–¥–µ–æ–∑–∞–ø–∏—Å –¥–æ–ø–æ–≤—ñ–¥—ñ: https://youtu.be/9cNIhrREGag
     –•—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –æ–ø–∏—Å –≤—ñ–¥–µ–æ–∑–∞–ø–∏—Å—É:
00:00 –í—Å—Ç—É–ø
00:12 –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä—É
00:26 –ì—Ä–∞—Ñ—ñ—á–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å Scalar
00:46 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
01:00 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
01:15 –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
01:36 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
01:47 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—è
01:56 –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
02:20 –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
02:32 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–µ–≤–∞–π—Å—É
02:43 –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–µ–≤–∞–π—Å—É
02:51 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–µ–≤–∞–π—Å—É
02:59 –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–µ–≤–∞–π—Å—É —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
03:12 –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω—É –¥–µ–≤–∞–π—Å—É
03:29 –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó
03:42 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó
03:50 –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
04:24 –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–ª—é—á–∞ —ñ–Ω—à–æ–≥–æ –¥–µ–≤–∞–π—Å—É
04:34 –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–µ–≤–∞–π—Å—É
04:47 –í–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
05:05 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏
05:15 –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏ –±–µ–∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
05:24 –í–∏—Å–Ω–æ–≤–∫–∏
                                                                            20
                                  –î–û–î–ê–¢–û–ö –ë
                          SQL –∫–æ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

1    -- LumiRum Database Schema
2
3    CREATE TYPE user_role AS ENUM (
4        'admin', -- server access, for maintenance
5        'owner', -- full home control
6        'user'    -- can control public devices and read config of other
   devices
 7 );
 8
 9 CREATE TABLE users (
10     id BIGSERIAL PRIMARY KEY,
11     username TEXT NOT NULL CONSTRAINT users_username_key UNIQUE CHECK
   (length(username) >= 3),
12     password_hash TEXT NOT NULL, -- argon2id
13     role user_role NOT NULL DEFAULT 'owner',
14     -- If role is 'user', this MUST NOT be NULL.
15     parent_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
16     created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
17
18     CHECK (role != 'user' OR parent_id IS NOT NULL)
19 );
20
21 CREATE INDEX idx_users_parent_id ON users(parent_id) WHERE parent_id
   IS NOT NULL;
22
23
24 -- Circadian Rhythm Settings
25 CREATE TABLE profiles (
26     id BIGSERIAL PRIMARY KEY,
27     name TEXT NOT NULL CHECK (length(name) > 0 AND length(name) <=
     200),
28
29         owner_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
30         is_shared BOOLEAN NOT NULL DEFAULT true, -- Can other accounts see
     it?
31
32         -- Location, for solar cycle calculation
33         latitude DOUBLE PRECISION CHECK (latitude BETWEEN -90 AND 90),
34         longitude DOUBLE PRECISION CHECK (longitude BETWEEN -180 AND 180),
35
36         timezone TEXT NOT NULL DEFAULT 'UTC', -- IANA: 'Europe/Kyiv'
37         -- Local time in user's timezone
38         sleep_start TIME NOT NULL DEFAULT '22:00',
39         sleep_end TIME NOT NULL DEFAULT '07:00',
40
41         night_mode_enabled BOOLEAN NOT NULL DEFAULT true,
42
43         -- Color temperature limits
                                                                            21

44       min_color_temp INTEGER NOT NULL DEFAULT 2000 CHECK (min_color_temp
     BETWEEN 1800 AND 10000),
45       max_color_temp INTEGER NOT NULL DEFAULT 6500 CHECK (max_color_temp
     BETWEEN 1800 AND 10000),
46
47     -- Timing
48     motion_timeout_seconds INTEGER NOT NULL DEFAULT 300,
49
50     created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
51
52     CONSTRAINT profiles_owner_id_name_key UNIQUE (owner_id, name),
53     CHECK (min_color_temp <= max_color_temp)
54 );
55
56 CREATE INDEX idx_profiles_owner_id ON profiles(owner_id);
57
58
59 CREATE TABLE devices (
60     id BIGSERIAL PRIMARY KEY,
61     name TEXT NOT NULL CHECK (length(name) > 0 AND length(name) <=
     200),
62       secret_key TEXT NOT NULL UNIQUE, -- device auth token
63
64       profile_id BIGINT REFERENCES profiles(id) ON DELETE SET NULL,
65       owner_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
66       is_public BOOLEAN NOT NULL DEFAULT true, -- Can a User role
   control it?
67
68     firmware_version TEXT,
69     last_seen TIMESTAMPTZ,
70
71     created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
72
73     CONSTRAINT devices_owner_id_name_key UNIQUE (owner_id, name)
74 );
75
76 CREATE INDEX idx_devices_owner_id ON devices(owner_id);
77 CREATE INDEX idx_devices_profile_id ON devices(profile_id) WHERE
     profile_id IS NOT NULL;
78
79
80 -- Telemetry events from devices
81 CREATE TABLE telemetry (
82     id BIGSERIAL PRIMARY KEY,
83     device_id BIGINT NOT NULL REFERENCES devices(id) ON DELETE
     CASCADE,
84
85       event_type TEXT NOT NULL, -- 'motion_detected', 'light_on',
     'light_off', etc.
86       motion_detected BOOLEAN,
87       light_is_on BOOLEAN,
88       brightness SMALLINT CHECK (brightness BETWEEN 0 AND 100),
                                                                        22

89     color_temp SMALLINT CHECK (color_temp BETWEEN 1800 AND 10000),
90
91     -- Sensor data
92     ambient_light SMALLINT, -- photoresistor ADC value
93
94     created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
95 );
96
97 CREATE INDEX idx_telemetry_device_time ON telemetry(device_id,
   created_at DESC);
98 CREATE INDEX idx_telemetry_event_type ON telemetry(event_type,
    created_at DESC);
 99
100
101 -- CHANGE AFTER INITIAL DEPLOYMENT
102 -- Default admin user with password: 'lumirum!'
103 INSERT INTO users (username, role, password_hash) VALUES
104     ('admin', 'admin',
    '$argon2id$v=19$m=32768,t=3,p=1$dGVzdHNhbHQ$phr/
    Oj1wInJyuWLDue7DYBqDIfIHWLgDY8W1iXQ61g8');
                                                                23
                                 –î–û–î–ê–¢–û–ö –í
                    –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö –¥–ª—è profile

 1   use chrono::{
 2       DateTime,
 3       NaiveTime,
 4       Utc,
 5   };
 6   use garde::{
 7       Valid,
 8       Validate,
 9   };
10   use serde::{
11       Deserialize,
12       Serialize,
13   };
14   use sqlx::PgPool;
15   use utoipa::ToSchema;
16
17   use crate::errors::Error;
18
19   #[derive(Debug, Clone, Serialize, ToSchema)]
20   pub struct Profile {
21       pub id: i64,
22       pub name: String,
23
24       pub owner_id: i64,
25       /// Whether the sub-users will see the profile
26       pub is_shared: bool,
27
28       pub latitude: Option<f64>,
29       pub longitude: Option<f64>,
30
31       pub timezone: String, // TODO: chrono-tz
32
33       #[schema(value_type = String, example = "22:00:00")]
34       pub sleep_start: NaiveTime,
35       #[schema(value_type = String, example = "07:00:00")]
36       pub sleep_end: NaiveTime,
37
38       pub night_mode_enabled: bool,
39       pub min_color_temp: i32,
40       pub max_color_temp: i32,
41       pub motion_timeout_seconds: i32,
42
43       pub created_at: DateTime<Utc>,
44   }
45
46   #[derive(Debug, Deserialize, Validate, ToSchema)]
47   #[garde(allow_unvalidated)]
48   #[schema(as = CreateProfileRequest)]
49   pub struct CreateProfile {
50       #[garde(length(chars, min = 1))]
51       #[schema(min_length = 1, example = "Living Room")]
52       pub name: String,
                                                                        24

 53
 54     pub latitude: Option<f64>,
 55     pub longitude: Option<f64>,
 56
 57     /// Whether the sub-users will see the profile
 58     #[schema(default = true)]
 59     pub is_shared: bool,
 60
 61     #[schema(default = "UTC", example = "Europe/Kyiv")]
 62     pub timezone: String,
 63
 64     #[schema(value_type = String, example = "22:00:00")]
 65     pub sleep_start: NaiveTime,
 66
 67     #[schema(value_type = String, example = "07:00:00")]
 68     pub sleep_end: NaiveTime,
 69
 70     pub night_mode_enabled: bool,
 71
 72     #[garde(range(min = 1800, max = 10000))]
 73     #[schema(default = 2000, minimum = 1800, maximum = 10000)]
 74     pub min_color_temp: i32,
 75
 76     #[garde(range(min = self.min_color_temp, max = 10000))]
 77     #[schema(default = 6500, minimum = 1800, maximum = 10000)]
 78     pub max_color_temp: i32,
 79
 80     #[schema(default = 300)]
 81     pub motion_timeout_seconds: i32,
 82 }
 83
 84 impl Profile {
 85     pub async fn create(
 86         pool: &PgPool,
 87         owner_id: i64,
 88         data: Valid<CreateProfile>,
 89     ) -> Result<Self, Error> {
 90         let profile = sqlx::query_as!(
 91             Self,
 92             r#"
 93             INSERT INTO profiles (
 94                 owner_id, name, latitude, longitude, timezone,
 95                 sleep_start, sleep_end, night_mode_enabled,
 96                 min_color_temp, max_color_temp, motion_timeout_seconds
 97             )
 98             VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
 99             RETURNING *
100             "#,
101             owner_id,
102             data.name,
103             data.latitude,
104             data.longitude,
105             data.timezone,
106             data.sleep_start,
107             data.sleep_end,
108             data.night_mode_enabled,
                                                                             25

109                 data.min_color_temp,
110                 data.max_color_temp,
111                 data.motion_timeout_seconds
112             )
113             .fetch_one(pool)
114             .await?;
115
116             Ok(profile)
117         }
118
119         pub async fn get_by_id(pool: &PgPool, id: i64) -> Result<Self,
      Error> {
120             sqlx::query_as!(Self, "SELECT * FROM profiles WHERE id = $1",
      id)
121                 .fetch_optional(pool)
122                 .await?
123                 .ok_or(Error::ProfileNotFound)
124         }
125
126         /// Get owner's devices and their users' public devices
127         pub async fn list_as_owner(pool: &PgPool, owner_id: i64) ->
      Result<Vec<Self>, Error> {
128           Ok(sqlx::query_as!(
129               Self,
130               "SELECT * FROM profiles WHERE owner_id = $1 OR (
131                   owner_id IN (SELECT id FROM users WHERE parent_id =
      $1)
132                     AND is_shared = true
133                  ) ORDER BY created_at DESC",
134                 owner_id
135             )
136             .fetch_all(pool)
137             .await?)
138         }
139
140         /// Get user's devices and their parent's public devices
141         pub async fn list_as_user(
142             pool: &PgPool,
143             user_id: i64,
144             parent_id: i64,
145         ) -> Result<Vec<Self>, Error> {
146             Ok(sqlx::query_as!(
147                 Self,
148                 "SELECT * FROM profiles WHERE owner_id = $1 OR (
149                      owner_id = $2 AND is_shared = true
150                  ) ORDER BY created_at DESC",
151                 user_id,
152                 parent_id,
153             )
154             .fetch_all(pool)
155             .await?)
156         }
157
                                                                            26

158      async fn get_by_id_for_update(conn: &mut sqlx::PgConnection, id:
      i64) -> Result<Self, Error> {
159           sqlx::query_as!(Self, "SELECT * FROM profiles WHERE id = $1
      FOR UPDATE", id)
160               .fetch_optional(conn)
161               .await?
162               .ok_or(Error::ProfileNotFound)
163       }
164
165      pub async fn update<F>(pool: &PgPool, id: i64, func: F) ->
      Result<Self, Error>
166       where
167           F: FnOnce(&mut Self) -> Result<bool, Error>,
168       {
169           let mut tx = pool.begin().await?;
170
171          let mut profile = Self::get_by_id_for_update(&mut tx,
      id).await?;
172
173          let updated = func(&mut profile)?;
174
175          if !updated {
176              return Ok(profile);
177          }
178
179          // TODO: Validation?
180          let profile = sqlx::query_as!(
181              Self,
182              r#"
183              UPDATE profiles
184              SET
185                  name = $1,
186                  latitude = $2,
187                  longitude = $3,
188                  timezone = $4,
189                  sleep_start = $5,
190                  sleep_end = $6,
191                  night_mode_enabled = $7,
192                  min_color_temp = $8,
193                  max_color_temp = $9,
194                  motion_timeout_seconds = $10
195              WHERE id = $11
196              RETURNING *
197              "#,
198              profile.name,
199              profile.latitude,
200              profile.longitude,
201              profile.timezone,
202              profile.sleep_start,
203              profile.sleep_end,
204              profile.night_mode_enabled,
205              profile.min_color_temp,
206              profile.max_color_temp,
207              profile.motion_timeout_seconds,
                                                                      27

208                 profile.id
209          )
210          .fetch_one(&mut *tx)
211          .await?;
212
213          tx.commit().await?;
214
215          Ok(profile)
216      }
217
218      pub async fn delete<F>(pool: &PgPool, id: i64, func: F) ->
      Result<(), Error>
219       where
220           F: FnOnce(&mut Self) -> Result<bool, Error>,
221       {
222           let mut tx = pool.begin().await?;
223
224          let mut profile = Self::get_by_id_for_update(&mut tx,
      id).await?;
225
226          let delete = func(&mut profile)?;
227
228          if !delete {
229              return Ok(());
230          }
231
232          sqlx::query!("DELETE FROM profiles WHERE id = $1", id)
233              .execute(&mut *tx)
234              .await?;
235
236          tx.commit().await?;
237
238          Ok(())
239      }
240
241      pub fn patch(&mut self, new: CreateProfile) -> bool {
242          // TODO: this begs for refactor
243          #[allow(clippy::useless_let_if_seq)]
244          let mut updated = false;
245
246          if self.name != new.name {
247              self.name = new.name;
248              updated = true;
249          }
250          if self.is_shared != new.is_shared {
251              self.is_shared = new.is_shared;
252              updated = true;
253          }
254          if self.latitude != new.latitude {
255              self.latitude = new.latitude;
256              updated = true;
257          }
258          if self.longitude != new.longitude {
259              self.longitude = new.longitude;
260              updated = true;
                                                                          28

261           }
262           if self.timezone != new.timezone {
263               self.timezone = new.timezone;
264               updated = true;
265           }
266           if self.sleep_start != new.sleep_start {
267               self.sleep_start = new.sleep_start;
268               updated = true;
269           }
270           if self.sleep_end != new.sleep_end {
271               self.sleep_end = new.sleep_end;
272               updated = true;
273           }
274           if self.night_mode_enabled != new.night_mode_enabled {
275               self.night_mode_enabled = new.night_mode_enabled;
276               updated = true;
277           }
278           if self.min_color_temp != new.min_color_temp {
279               self.min_color_temp = new.min_color_temp;
280               updated = true;
281           }
282           if self.max_color_temp != new.max_color_temp {
283               self.max_color_temp = new.max_color_temp;
284               updated = true;
285           }
286           if self.motion_timeout_seconds != new.motion_timeout_seconds {
287               self.motion_timeout_seconds = new.motion_timeout_seconds;
288               updated = true;
289           }
290
291           updated
292       }
293   }

